0001   0000             ;
0002   0000             ; PIO 82C55 I/O IS DECODED TO PORT 60-67
0003   0000             ;
0004   0000             PIOA		.EQU 	60H		; PORT A
0005   0000             PIOB		.EQU 	61H		; PORT B
0006   0000             PIOC		.EQU 	62H		; PORT C
0007   0000             PIOX	 	.EQU 	63H		; PIO CONTROL PORT
0008   0000             ;
0009   0000             CPUFREQ	.EQU	20
0010   0000             ;
0011   0100             	.ORG	$100
0012   0100             	; SAVE PREVIOUS STACK POINTER, AND SWITCH TO OUR STACK
0013   0100 ED 73 15 0C 	LD	(STACKSAV),SP
0014   0104 31 57 0C    	LD	SP,STACK
0015   0107             	
0016   0107 11 F7 06    	LD	DE,PPPSTR_BANNER
0017   010A CD 0D 09    	CALL	WRITESTR
0018   010D             
0019   010D 11 22 07    	LD	DE,PPPSTR_INTRO
0020   0110 CD 0D 09    	CALL	WRITESTR
0021   0113             
0022   0113 11 36 08    	LD	DE,PPPSTR_CONFIRM
0023   0116 CD 0D 09    	CALL	WRITESTR
0024   0119             	
0025   0119             CONF:
0026   0119 CD B6 09    	CALL	CIN
0027   011C FE 1B       	CP	$1B
0028   011E 28 0A       	JR	Z,EXIT
0029   0120 FE 0D       	CP	$0D
0030   0122 20 F5       	JR	NZ,CONF
0031   0124             	
0032   0124             	; INITIALIZATION
0033   0124 CD 35 01    	CALL	INIT
0034   0127             	
0035   0127             	; PERFORM TESTS
0036   0127 CD B5 01    	CALL	RUNTESTS
0037   012A             
0038   012A             EXIT:	
0039   012A             	; CLEAN UP AND RETURN TO OS
0040   012A CD 8A 08    	CALL	NEWLINE
0041   012D CD 8A 08    	CALL	NEWLINE
0042   0130 ED 7B 15 0C 	LD	SP,(STACKSAV)
0043   0134             	
0044   0134 C9          	RET
0045   0135             	
0046   0135             INIT:
0047   0135 11 BE 05    	LD	DE,PPPSTR_INIT
0048   0138 CD 0D 09    	CALL	WRITESTR
0049   013B             	
0050   013B 3E 9B       	LD	A,$9B			; PPI MODE 0, ALL PINS INPUT
0051   013D D3 63       	OUT	(PIOX),A		; SEND IT
0052   013F             
0053   013F 3E C2       	LD	A,11000010B		; PPI MODE 2 (BI HANDSHAKE), PC0-2 OUT, PB IN
0054   0141 D3 63       	OUT	(PIOX),A
0055   0143 CD 67 08    	CALL	PC_PERIOD
0056   0146             	
0057   0146 CD 86 09    	CALL	DELAY			; PROBABLY NOT NEEDED
0058   0149             	
0059   0149 3E 00       	LD	A,00000000B		; SET PC0 -> 0
0060   014B D3 63       	OUT	(PIOX),A
0061   014D 3E 02       	LD	A,00000010B		; SET PC1 -> 0
0062   014F D3 63       	OUT	(PIOX),A
0063   0151 3E 05       	LD	A,00000101B		; SET PC2 -> 1 - ASSERT RESET ON PPP
0064   0153 D3 63       	OUT	(PIOX),A
0065   0155 3E 06       	LD	A,00000110B		; SET PC3 -> 0
0066   0157 D3 63       	OUT	(PIOX),A
0067   0159 CD 67 08    	CALL	PC_PERIOD
0068   015C             	
0069   015C CD 86 09    	CALL	DELAY			; PROBABLY NOT NEEDED
0070   015F             	
0071   015F DB 60       	IN	A,(PIOA)		; CLEAR GARBAGE???
0072   0161 CD 67 08    	CALL	PC_PERIOD
0073   0164             	
0074   0164 CD 86 09    	CALL	DELAY			; PROBABLY NOT NEEDED
0075   0167             	
0076   0167 3E 01       	LD	A,00000001B	; SET CMD FLAG
0077   0169 D3 63       	OUT	(PIOX),A	; SEND IT
0078   016B 0E F0       	LD	C,$F0
0079   016D CD 94 05    	CALL	PUTBYTE		; SEND THE COMMAND BYTE
0080   0170 CD 86 09    	CALL	DELAY
0081   0173 3E 00       	LD	A,00000000B	; CLEAR CMD FLAG
0082   0175 D3 63       	OUT	(PIOX),A
0083   0177             	
0084   0177 3E 04       	LD	A,00000100B		; SET PC2 -> 0 - DEASSERT RESET ON PPP
0085   0179 D3 63       	OUT	(PIOX),A
0086   017B             	
0087   017B CD 86 09    	CALL	DELAY			; PROBABLY NOT NEEDED
0088   017E             	
0089   017E             INIT0:
0090   017E 01 00 00    	LD	BC,0
0091   0181             INIT1:
0092   0181 C5          	PUSH	BC
0093   0182 CD 86 09    	CALL	DELAY
0094   0185 CD 86 09    	CALL	DELAY
0095   0188 CD 86 09    	CALL	DELAY
0096   018B CD 86 09    	CALL	DELAY
0097   018E DB 60       	IN	A,(PIOA)
0098   0190 C1          	POP	BC
0099   0191 FE AA       	CP	$AA
0100   0193 28 18       	JR	Z,INIT2
0101   0195 0B          	DEC	BC
0102   0196 78          	LD	A,B
0103   0197 B1          	OR	C
0104   0198 20 E7       	JR	NZ,INIT1
0105   019A             	
0106   019A 11 88 06    	LD	DE,PPPSTR_TIMEOUT
0107   019D CD 0D 09    	CALL	WRITESTR
0108   01A0 CD 62 08    	CALL	PC_SPACE
0109   01A3 3E 01       	LD	A,1
0110   01A5 CD 91 08    	CALL	PRTHEXBYTE
0111   01A8 CD 8A 08    	CALL	NEWLINE
0112   01AB 37          	SCF
0113   01AC C9          	RET
0114   01AD             
0115   01AD             INIT2:
0116   01AD             
0117   01AD 11 85 06    	LD	DE,PPPSTR_OK
0118   01B0 CD 0D 09    	CALL	WRITESTR
0119   01B3             	
0120   01B3 AF          	XOR	A
0121   01B4 C9          	RET
0122   01B5             	
0123   01B5             RUNTESTS:
0124   01B5 CD DA 01    	CALL	TEST1
0125   01B8 D8          	RET	C
0126   01B9             	
0127   01B9 CD 17 02    	CALL	TEST2
0128   01BC D8          	RET	C
0129   01BD             	
0130   01BD CD 86 02    	CALL	TEST3
0131   01C0 D8          	RET	C
0132   01C1             	
0133   01C1 CD D6 02    	CALL	TEST4
0134   01C4 D8          	RET	C
0135   01C5             	
0136   01C5 CD 4D 03    	CALL	TEST5
0137   01C8 D8          	RET	C
0138   01C9             	
0139   01C9 CD 80 03    	CALL	TEST6
0140   01CC D8          	RET	C
0141   01CD             	
0142   01CD CD B7 03    	CALL	TEST7
0143   01D0 D8          	RET	C
0144   01D1             	
0145   01D1 CD E5 03    	CALL	TEST8
0146   01D4 D8          	RET	C
0147   01D5             	
0148   01D5 CD 29 04    	CALL	TEST9
0149   01D8 D8          	RET	C
0150   01D9             	
0151   01D9 C9          	RET
0152   01DA             	
0153   01DA             TEST1:
0154   01DA 11 CD 05    	LD	DE,PPPSTR_BYTEECHO
0155   01DD CD 0D 09    	CALL	WRITESTR
0156   01E0             
0157   01E0 06 10       	LD	B,$10
0158   01E2 0E AA       	LD	C,$AA
0159   01E4             TEST1A:
0160   01E4 C5          	PUSH	BC
0161   01E5 CD 04 02    	CALL	DOECHO
0162   01E8 C1          	POP	BC
0163   01E9 20 11       	JR	NZ,TEST1_ERR
0164   01EB CD 67 08    	CALL	PC_PERIOD
0165   01EE 79          	LD	A,C
0166   01EF EE FF       	XOR	$FF
0167   01F1 4F          	LD	C,A
0168   01F2 10 F0       	DJNZ	TEST1A
0169   01F4             
0170   01F4 11 85 06    	LD	DE,PPPSTR_OK
0171   01F7 CD 0D 09    	CALL	WRITESTR
0172   01FA             	
0173   01FA AF          	XOR	A
0174   01FB C9          	RET
0175   01FC             
0176   01FC             TEST1_ERR:
0177   01FC 11 57 06    	LD	DE,PPPSTR_CMPERR
0178   01FF CD 0D 09    	CALL	WRITESTR
0179   0202 37          	SCF
0180   0203 C9          	RET
0181   0204             	
0182   0204             DOECHO:
0183   0204 C5          	PUSH	BC
0184   0205 0E 01       	LD	C,1		; CMD=ECHOBYTE
0185   0207 CD 73 05    	CALL	SENDCMD
0186   020A C1          	POP	BC
0187   020B             
0188   020B 51          	LD	D,C
0189   020C CD 94 05    	CALL	PUTBYTE
0190   020F CD A5 05    	CALL	GETBYTE
0191   0212 79          	LD	A,C
0192   0213 EE FF       	XOR	$FF
0193   0215 BA          	CP	D
0194   0216 C9          	RET
0195   0217             	
0196   0217             TEST2:
0197   0217 11 D9 05    	LD	DE,PPPSTR_BUFECHO
0198   021A CD 0D 09    	CALL	WRITESTR
0199   021D             
0200   021D 06 10       	LD	B,$10
0201   021F             TEST2A:
0202   021F C5          	PUSH	BC
0203   0220 CD 44 02    	CALL	DOBUFECHO
0204   0223 C1          	POP	BC
0205   0224 20 0D       	JR	NZ,TEST2_ERR
0206   0226 CD 67 08    	CALL	PC_PERIOD
0207   0229 10 F4       	DJNZ	TEST2A
0208   022B             
0209   022B 11 85 06    	LD	DE,PPPSTR_OK
0210   022E CD 0D 09    	CALL	WRITESTR
0211   0231             	
0212   0231 AF          	XOR	A
0213   0232 C9          	RET
0214   0233             	
0215   0233             TEST2_ERR:
0216   0233 11 57 06    	LD	DE,PPPSTR_CMPERR
0217   0236 CD 0D 09    	CALL	WRITESTR
0218   0239 CD 8A 08    	CALL	NEWLINE
0219   023C 11 00 A0    	LD	DE,SECBUF
0220   023F CD C2 09    	CALL	DUMP_BUFFER
0221   0242 37          	SCF
0222   0243 C9          	RET
0223   0244             	
0224   0244             DOBUFECHO:
0225   0244 0E 02       	LD	C,2		; COMMAND = ECHOBUF
0226   0246 CD 73 05    	CALL	SENDCMD
0227   0249             	
0228   0249 CD 2D 0A    	CALL	PAT_BUFFER
0229   024C CD 64 0A    	CALL	SAVE_BUFFER
0230   024F CD 5C 02    	CALL	PUTBUF
0231   0252 CD 1C 0A    	CALL	FILL_BUFFER
0232   0255 CD 71 02    	CALL	GETBUF
0233   0258 CD 70 0A    	CALL	CMP_BUFFER
0234   025B C9          	RET
0235   025C             	
0236   025C             PUTBUF:
0237   025C 01 00 02    	LD	BC,512
0238   025F 21 00 A0    	LD	HL,SECBUF
0239   0262             PUTBUF1:
0240   0262 C5          	PUSH	BC
0241   0263 7E          	LD	A,(HL)
0242   0264 23          	INC	HL
0243   0265 4F          	LD	C,A
0244   0266 CD 94 05    	CALL	PUTBYTE
0245   0269 C1          	POP	BC
0246   026A 0B          	DEC	BC
0247   026B 78          	LD	A,B
0248   026C B1          	OR	C
0249   026D C2 62 02    	JP	NZ,PUTBUF1
0250   0270 C9          	RET
0251   0271             	
0252   0271             GETBUF:
0253   0271 01 00 02    	LD	BC,512
0254   0274 21 00 A0    	LD	HL,SECBUF
0255   0277             GETBUF1:
0256   0277 C5          	PUSH	BC
0257   0278 CD A5 05    	CALL	GETBYTE
0258   027B 79          	LD	A,C
0259   027C 77          	LD	(HL),A
0260   027D 23          	INC	HL
0261   027E C1          	POP	BC
0262   027F 0B          	DEC	BC
0263   0280 78          	LD	A,B
0264   0281 B1          	OR	C
0265   0282 C2 77 02    	JP	NZ,GETBUF1
0266   0285 C9          	RET
0267   0286             	
0268   0286             TEST3:
0269   0286 11 E7 05    	LD	DE,PPPSTR_ABTTST
0270   0289 CD 0D 09    	CALL	WRITESTR
0271   028C             	
0272   028C 0E 12       	LD	C,$12
0273   028E CD 73 05    	CALL	SENDCMD
0274   0291 01 F4 01    	LD	BC,500			; UNDERFLOW ON PUTBUF
0275   0294 21 00 A0    	LD	HL,SECBUF
0276   0297 CD 62 02    	CALL	PUTBUF1
0277   029A 0E 00       	LD	C,0
0278   029C CD 73 05    	CALL	SENDCMD
0279   029F CD 67 08    	CALL	PC_PERIOD
0280   02A2             	
0281   02A2 0E 12       	LD	C,$12
0282   02A4 CD 73 05    	CALL	SENDCMD
0283   02A7 01 58 02    	LD	BC,600			; OVERFLOW ON PUTBUF
0284   02AA 21 00 A0    	LD	HL,SECBUF
0285   02AD CD 62 02    	CALL	PUTBUF1
0286   02B0 0E 00       	LD	C,0
0287   02B2 CD 73 05    	CALL	SENDCMD
0288   02B5 CD 67 08    	CALL	PC_PERIOD
0289   02B8             
0290   02B8 0E 13       	LD	C,$13
0291   02BA CD 73 05    	CALL	SENDCMD
0292   02BD 01 F4 01    	LD	BC,500			; UNDERFLOW ON GETBUF
0293   02C0 21 00 A0    	LD	HL,SECBUF
0294   02C3 CD 77 02    	CALL	GETBUF1
0295   02C6 0E 00       	LD	C,0
0296   02C8 CD 73 05    	CALL	SENDCMD
0297   02CB CD 67 08    	CALL	PC_PERIOD
0298   02CE             	
0299   02CE 11 85 06    	LD	DE,PPPSTR_OK
0300   02D1 CD 0D 09    	CALL	WRITESTR
0301   02D4             	
0302   02D4 AF          	XOR	A
0303   02D5 C9          	RET
0304   02D6             
0305   02D6             TEST4:
0306   02D6 11 FC 05    	LD	DE,PPPSTR_DISKRW
0307   02D9 CD 0D 09    	CALL	WRITESTR
0308   02DC             
0309   02DC CD D6 04    	CALL	DSKRESET
0310   02DF 20 35       	JR	NZ,TEST4_IOERR
0311   02E1 CD 67 08    	CALL	PC_PERIOD
0312   02E4             
0313   02E4 CD 2D 0A    	CALL	PAT_BUFFER
0314   02E7 CD 64 0A    	CALL	SAVE_BUFFER
0315   02EA             
0316   02EA 06 10       	LD	B,$10
0317   02EC             TEST4A:
0318   02EC C5          	PUSH	BC
0319   02ED 01 00 00    	LD	BC,0
0320   02F0 ED 43 B8 05 	LD	(PPP_LBAHI),BC
0321   02F4 CD 9C 0A    	CALL	RNDBYTE
0322   02F7 4F          	LD	C,A
0323   02F8 ED 43 B6 05 	LD	(PPP_LBALO),BC
0324   02FC CD B8 04    	CALL	DSKRW
0325   02FF C1          	POP	BC
0326   0300 20 14       	JR	NZ,TEST4_IOERR
0327   0302 C5          	PUSH	BC
0328   0303 CD 70 0A    	CALL	CMP_BUFFER
0329   0306 C1          	POP	BC
0330   0307 20 36       	JR	NZ,TEST4_CMPERR
0331   0309 CD 67 08    	CALL	PC_PERIOD
0332   030C 10 DE       	DJNZ	TEST4A
0333   030E             	
0334   030E 11 85 06    	LD	DE,PPPSTR_OK
0335   0311 CD 0D 09    	CALL	WRITESTR
0336   0314             	
0337   0314 AF          	XOR	A
0338   0315 C9          	RET
0339   0316             
0340   0316             TEST4_IOERR:
0341   0316 11 69 06    	LD	DE,PPPSTR_IOERR
0342   0319 CD 0D 09    	CALL	WRITESTR
0343   031C             
0344   031C 11 76 06    	LD	DE,PPPSTR_DSKSTAT
0345   031F CD 0D 09    	CALL	WRITESTR
0346   0322             
0347   0322 CD E1 04    	CALL	DSKSTAT
0348   0325 ED 4B BC 05 	LD	BC,(PPP_DSKSTHI)
0349   0329 78          	LD	A,B
0350   032A CD 91 08    	CALL	PRTHEXBYTE
0351   032D 79          	LD	A,C
0352   032E CD 91 08    	CALL	PRTHEXBYTE
0353   0331 ED 4B BA 05 	LD	BC,(PPP_DSKSTLO)
0354   0335 78          	LD	A,B
0355   0336 CD 91 08    	CALL	PRTHEXBYTE
0356   0339 79          	LD	A,C
0357   033A CD 91 08    	CALL	PRTHEXBYTE
0358   033D             
0359   033D 37          	SCF
0360   033E C9          	RET
0361   033F             	
0362   033F             TEST4_CMPERR:
0363   033F 11 57 06    	LD	DE,PPPSTR_CMPERR
0364   0342 CD 0D 09    	CALL	WRITESTR
0365   0345 11 00 A0    	LD	DE,SECBUF
0366   0348 CD C2 09    	CALL	DUMP_BUFFER
0367   034B 37          	SCF
0368   034C C9          	RET
0369   034D             	
0370   034D             TEST5:
0371   034D 11 0E 06    	LD	DE,PPPSTR_VIDEO
0372   0350 CD 0D 09    	CALL	WRITESTR
0373   0353             	
0374   0353 0E 0D       	LD	C,CHR_CR
0375   0355 CD AD 04    	CALL	VIDOUT
0376   0358 0E 0A       	LD	C,CHR_LF
0377   035A CD AD 04    	CALL	VIDOUT
0378   035D             	
0379   035D 06 1A       	LD	B,26
0380   035F 0E 40       	LD	C,'A' - 1
0381   0361             TEST5A:
0382   0361 79          	LD	A,C
0383   0362 3C          	INC	A
0384   0363 4F          	LD	C,A
0385   0364 C5          	PUSH	BC
0386   0365 CD AD 04    	CALL	VIDOUT
0387   0368 C1          	POP	BC
0388   0369 CD 67 08    	CALL	PC_PERIOD
0389   036C 10 F3       	DJNZ	TEST5A
0390   036E             	
0391   036E 0E 0D       	LD	C,CHR_CR
0392   0370 CD AD 04    	CALL	VIDOUT
0393   0373 0E 0A       	LD	C,CHR_LF
0394   0375 CD AD 04    	CALL	VIDOUT
0395   0378             	
0396   0378 11 85 06    	LD	DE,PPPSTR_OK
0397   037B CD 0D 09    	CALL	WRITESTR
0398   037E             	
0399   037E AF          	XOR	A
0400   037F C9          	RET
0401   0380             	
0402   0380             TEST6:
0403   0380 11 16 06    	LD	DE,PPPSTR_KEYBOARD
0404   0383 CD 0D 09    	CALL	WRITESTR
0405   0386             	
0406   0386 21 9C 06    	LD	HL,PPSTR_KBDPRMPT
0407   0389             TEST6X:
0408   0389 7E          	LD	A,(HL)
0409   038A 23          	INC	HL
0410   038B FE 24       	CP	'$'
0411   038D 28 06       	JR	Z,TEST6A
0412   038F 4F          	LD	C,A
0413   0390 CD AD 04    	CALL	VIDOUT
0414   0393 18 F4       	JR	TEST6X
0415   0395             
0416   0395             TEST6A:	
0417   0395 CD 8F 04    	CALL	KBDIN
0418   0398 79          	LD	A,C
0419   0399 FE 1B       	CP	$1B
0420   039B 28 08       	JR	Z,TEST6B
0421   039D CD 67 08    	CALL	PC_PERIOD
0422   03A0 CD AD 04    	CALL	VIDOUT
0423   03A3 18 F0       	JR	TEST6A
0424   03A5             
0425   03A5             TEST6B:
0426   03A5 0E 0D       	LD	C,CHR_CR
0427   03A7 CD AD 04    	CALL	VIDOUT
0428   03AA 0E 0A       	LD	C,CHR_LF
0429   03AC CD AD 04    	CALL	VIDOUT
0430   03AF             
0431   03AF 11 85 06    	LD	DE,PPPSTR_OK
0432   03B2 CD 0D 09    	CALL	WRITESTR
0433   03B5             	
0434   03B5 AF          	XOR	A
0435   03B6 C9          	RET
0436   03B7             	
0437   03B7             TEST7:
0438   03B7 11 21 06    	LD	DE,PPPSTR_SPEAKER
0439   03BA CD 0D 09    	CALL	WRITESTR
0440   03BD             	
0441   03BD 06 10       	LD	B,16
0442   03BF             TEST7A:
0443   03BF 10 02       	DJNZ	TEST7B
0444   03C1 18 1A       	JR	TEST7C
0445   03C3             TEST7B:
0446   03C3 C5          	PUSH	BC
0447   03C4 0E 40       	LD	C,$40	; SPEAKER TONE
0448   03C6 CD 73 05    	CALL	SENDCMD
0449   03C9             	
0450   03C9 78          	LD	A,B
0451   03CA 07          	RLCA
0452   03CB 07          	RLCA
0453   03CC 07          	RLCA
0454   03CD 07          	RLCA
0455   03CE 4F          	LD	C,A
0456   03CF CD 94 05    	CALL	PUTBYTE
0457   03D2 0E 10       	LD	C,16	; DURATION = 16/256 = 1/16 SEC
0458   03D4 CD 94 05    	CALL	PUTBYTE
0459   03D7 CD 67 08    	CALL	PC_PERIOD
0460   03DA C1          	POP	BC
0461   03DB 18 E2       	JR	TEST7A
0462   03DD             	
0463   03DD             TEST7C:
0464   03DD 11 85 06    	LD	DE,PPPSTR_OK
0465   03E0 CD 0D 09    	CALL	WRITESTR
0466   03E3             	
0467   03E3 AF          	XOR	A
0468   03E4 C9          	RET
0469   03E5             	
0470   03E5             TEST8:
0471   03E5 11 2B 06    	LD	DE,PPPSTR_SIOLOOP
0472   03E8 CD 0D 09    	CALL	WRITESTR
0473   03EB             	
0474   03EB 0E 55       	LD	C,$55		; RX FLUSH
0475   03ED CD 73 05    	CALL	SENDCMD
0476   03F0             	
0477   03F0 06 1A       	LD	B,26
0478   03F2 0E 40       	LD	C,'A' - 1
0479   03F4             TEST8A:
0480   03F4 79          	LD	A,C
0481   03F5 3C          	INC	A
0482   03F6 4F          	LD	C,A
0483   03F7 C5          	PUSH	BC
0484   03F8 CD 99 04    	CALL	SIOTX
0485   03FB CD A4 04    	CALL	SIORX
0486   03FE 79          	LD	A,C
0487   03FF C1          	POP	BC
0488   0400 B9          	CP	C
0489   0401 20 0D       	JR	NZ,TEST8_CMPERR
0490   0403             
0491   0403 CD 67 08    	CALL	PC_PERIOD
0492   0406 10 EC       	DJNZ	TEST8A
0493   0408             	
0494   0408 11 85 06    	LD	DE,PPPSTR_OK
0495   040B CD 0D 09    	CALL	WRITESTR
0496   040E             	
0497   040E AF          	XOR	A
0498   040F C9          	RET
0499   0410             
0500   0410             TEST8_CMPERR:
0501   0410 F5          	PUSH	AF
0502   0411 C5          	PUSH	BC
0503   0412 11 57 06    	LD	DE,PPPSTR_CMPERR
0504   0415 CD 0D 09    	CALL	WRITESTR
0505   0418 CD 6C 08    	CALL	PC_COLON
0506   041B C1          	POP	BC
0507   041C 79          	LD	A,C
0508   041D CD 91 08    	CALL	PRTHEXBYTE
0509   0420 CD 62 08    	CALL	PC_SPACE
0510   0423 F1          	POP	AF
0511   0424 CD 91 08    	CALL	PRTHEXBYTE
0512   0427             	
0513   0427 37          	SCF
0514   0428 C9          	RET
0515   0429             	
0516   0429             
0517   0429             	
0518   0429             TEST9:
0519   0429 11 42 06    	LD	DE,PPPSTR_SIOBUF
0520   042C CD 0D 09    	CALL	WRITESTR
0521   042F             	
0522   042F 0E 55       	LD	C,$55		; RX FLUSH
0523   0431 CD 73 05    	CALL	SENDCMD
0524   0434             	
0525   0434             	;LD	C,$53		; SERIAL RX STAT
0526   0434             	;CALL	SENDCMD
0527   0434             	;CALL	GETBYTE
0528   0434             	;CALL	PRTHEXBYTE
0529   0434             	;CALL	PC_SPACE
0530   0434             	
0531   0434             	;LD	C,$54		; SERIAL TX STAT
0532   0434             	;CALL	SENDCMD
0533   0434             	;CALL	GETBYTE
0534   0434             	;CALL	PRTHEXBYTE
0535   0434             	;CALL	PC_SPACE
0536   0434             	
0537   0434 0E 58       	LD	C,'X'
0538   0436 CD 99 04    	CALL	SIOTX
0539   0439 CD 67 08    	CALL	PC_PERIOD
0540   043C CD 99 04    	CALL	SIOTX
0541   043F CD 67 08    	CALL	PC_PERIOD
0542   0442 CD 99 04    	CALL	SIOTX
0543   0445 CD 67 08    	CALL	PC_PERIOD
0544   0448 CD 99 04    	CALL	SIOTX
0545   044B CD 67 08    	CALL	PC_PERIOD
0546   044E CD 99 04    	CALL	SIOTX
0547   0451 CD 67 08    	CALL	PC_PERIOD
0548   0454 CD 99 04    	CALL	SIOTX
0549   0457 CD 67 08    	CALL	PC_PERIOD
0550   045A CD 99 04    	CALL	SIOTX
0551   045D CD 67 08    	CALL	PC_PERIOD
0552   0460 CD 99 04    	CALL	SIOTX
0553   0463 CD 67 08    	CALL	PC_PERIOD
0554   0466             	
0555   0466             	;LD	C,$54		; SERIAL TX STAT
0556   0466             	;CALL	SENDCMD
0557   0466             	;CALL	GETBYTE
0558   0466             	;CALL	PRTHEXBYTE
0559   0466             	;CALL	PC_SPACE
0560   0466             	
0561   0466 CD 97 09    	CALL	LDELAY
0562   0469             
0563   0469 0E 53       	LD	C,$53		; SERIAL RX STAT
0564   046B CD 73 05    	CALL	SENDCMD
0565   046E CD A5 05    	CALL	GETBYTE
0566   0471 3E 08       	LD	A,8
0567   0473 B9          	CP	C
0568   0474 20 08       	JR	NZ,TEST9_CMPERR
0569   0476             
0570   0476 11 85 06    	LD	DE,PPPSTR_OK
0571   0479 CD 0D 09    	CALL	WRITESTR
0572   047C             	
0573   047C AF          	XOR	A
0574   047D C9          	RET
0575   047E             	
0576   047E             TEST9_CMPERR:
0577   047E C5          	PUSH	BC
0578   047F 11 57 06    	LD	DE,PPPSTR_CMPERR
0579   0482 CD 0D 09    	CALL	WRITESTR
0580   0485 CD 6C 08    	CALL	PC_COLON
0581   0488 C1          	POP	BC
0582   0489 79          	LD	A,C
0583   048A CD 91 08    	CALL	PRTHEXBYTE
0584   048D             	
0585   048D 37          	SCF
0586   048E C9          	RET
0587   048F             	
0588   048F             KBDIN:
0589   048F 0E 31       	LD	C,$31
0590   0491 CD 73 05    	CALL	SENDCMD
0591   0494 CD A5 05    	CALL	GETBYTE
0592   0497 79          	LD	A,C
0593   0498 C9          	RET
0594   0499             	
0595   0499             SIOTX:
0596   0499 C5          	PUSH	BC
0597   049A 0E 52       	LD	C,$52
0598   049C CD 73 05    	CALL	SENDCMD
0599   049F C1          	POP	BC
0600   04A0             
0601   04A0 CD 94 05    	CALL	PUTBYTE
0602   04A3 C9          	RET
0603   04A4             	
0604   04A4             SIORX:
0605   04A4 0E 51       	LD	C,$51
0606   04A6 CD 73 05    	CALL	SENDCMD
0607   04A9             
0608   04A9 CD A5 05    	CALL	GETBYTE
0609   04AC C9          	RET
0610   04AD             
0611   04AD             VIDOUT:
0612   04AD C5          	PUSH	BC
0613   04AE 0E 20       	LD	C,$20
0614   04B0 CD 73 05    	CALL	SENDCMD
0615   04B3 C1          	POP	BC
0616   04B4             
0617   04B4 CD 94 05    	CALL	PUTBYTE
0618   04B7 C9          	RET
0619   04B8             	
0620   04B8             DSKRW:
0621   04B8 CD 1C 0A    	CALL	FILL_BUFFER
0622   04BB CD 38 05    	CALL	DSKWRITE
0623   04BE C0          	RET	NZ
0624   04BF             
0625   04BF CD 1C 0A    	CALL	FILL_BUFFER
0626   04C2 CD FE 04    	CALL	DSKREAD
0627   04C5 C0          	RET	NZ
0628   04C6             	
0629   04C6 CD 2D 0A    	CALL	PAT_BUFFER
0630   04C9 CD 38 05    	CALL	DSKWRITE
0631   04CC C0          	RET	NZ
0632   04CD             
0633   04CD CD 1C 0A    	CALL	FILL_BUFFER
0634   04D0 CD FE 04    	CALL	DSKREAD
0635   04D3 C0          	RET	NZ
0636   04D4             	
0637   04D4 AF          	XOR	A
0638   04D5 C9          	RET
0639   04D6             
0640   04D6             DSKRESET
0641   04D6             	; RESET & STATUS DISK
0642   04D6 0E 10       	LD	C,$10		; COMMAND = DSKRESET
0643   04D8 CD 73 05    	CALL	SENDCMD
0644   04DB             	
0645   04DB CD A5 05    	CALL	GETBYTE
0646   04DE 79          	LD	A,C
0647   04DF             	;CALL	PRTHEXBYTE
0648   04DF B7          	OR	A
0649   04E0             	
0650   04E0 C9          	RET
0651   04E1             
0652   04E1             DSKSTAT:	
0653   04E1 0E 11       	LD	C,$11		; COMMAND = DSKSTAT
0654   04E3 CD 73 05    	CALL	SENDCMD
0655   04E6             	
0656   04E6 21 BA 05    	LD	HL,PPP_DSKSTAT
0657   04E9 CD AF 05    	CALL	GETBYTEA
0658   04EC 77          	LD	(HL),A
0659   04ED 23          	INC	HL
0660   04EE CD AF 05    	CALL	GETBYTEA
0661   04F1 77          	LD	(HL),A
0662   04F2 23          	INC	HL
0663   04F3 CD AF 05    	CALL	GETBYTEA
0664   04F6 77          	LD	(HL),A
0665   04F7 23          	INC	HL
0666   04F8 CD AF 05    	CALL	GETBYTEA
0667   04FB 77          	LD	(HL),A
0668   04FC 23          	INC	HL
0669   04FD             	
0670   04FD C9          	RET
0671   04FE             
0672   04FE             DSKREAD:	
0673   04FE             	; READ A SECTOR
0674   04FE 0E 14       	LD	C,$14		; COMMAND = DSKRD
0675   0500 CD 73 05    	CALL	SENDCMD
0676   0503             
0677   0503 21 B6 05    	LD	HL,PPP_LBA
0678   0506 7E          	LD	A,(HL)
0679   0507 23          	INC	HL
0680   0508 CD 9E 05    	CALL	PUTBYTEA
0681   050B 7E          	LD	A,(HL)
0682   050C 23          	INC	HL
0683   050D CD 9E 05    	CALL	PUTBYTEA
0684   0510 7E          	LD	A,(HL)
0685   0511 23          	INC	HL
0686   0512 CD 9E 05    	CALL	PUTBYTEA
0687   0515 7E          	LD	A,(HL)
0688   0516 23          	INC	HL
0689   0517 CD 9E 05    	CALL	PUTBYTEA
0690   051A             
0691   051A CD AF 05    	CALL	GETBYTEA		; GET RESULT
0692   051D             	
0693   051D             	;CALL	PRTHEXBYTE
0694   051D B7          	OR	A
0695   051E C0          	RET	NZ
0696   051F             	
0697   051F 0E 13       	LD	C,$13		; COMMAND = DSKGET
0698   0521 CD 73 05    	CALL	SENDCMD
0699   0524             
0700   0524 01 00 02    	LD	BC,512
0701   0527 21 00 A0    	LD	HL,SECBUF
0702   052A             DSKREAD1:
0703   052A C5          	PUSH	BC
0704   052B CD AF 05    	CALL	GETBYTEA
0705   052E 77          	LD	(HL),A
0706   052F 23          	INC	HL
0707   0530 C1          	POP	BC
0708   0531 0B          	DEC	BC
0709   0532 78          	LD	A,B
0710   0533 B1          	OR	C
0711   0534 C2 2A 05    	JP	NZ,DSKREAD1
0712   0537             
0713   0537 C9          	RET
0714   0538             	
0715   0538             DSKWRITE:	
0716   0538             	; WRITE A SECTOR
0717   0538 0E 12       	LD	C,$12		; COMMAND = DSKPUT
0718   053A CD 73 05    	CALL	SENDCMD
0719   053D             
0720   053D 01 00 02    	LD	BC,512
0721   0540 21 00 A0    	LD	HL,SECBUF
0722   0543             DSKWRITE1:
0723   0543 C5          	PUSH	BC
0724   0544 7E          	LD	A,(HL)
0725   0545 23          	INC	HL
0726   0546 CD 9E 05    	CALL	PUTBYTEA
0727   0549 C1          	POP	BC
0728   054A 0B          	DEC	BC
0729   054B 78          	LD	A,B
0730   054C B1          	OR	C
0731   054D C2 43 05    	JP	NZ,DSKWRITE1
0732   0550             
0733   0550 0E 15       	LD	C,$15		; COMMAND = DSKWR
0734   0552 CD 73 05    	CALL	SENDCMD
0735   0555             
0736   0555 21 B6 05    	LD	HL,PPP_LBA
0737   0558 7E          	LD	A,(HL)
0738   0559 23          	INC	HL
0739   055A CD 9E 05    	CALL	PUTBYTEA
0740   055D 7E          	LD	A,(HL)
0741   055E 23          	INC	HL
0742   055F CD 9E 05    	CALL	PUTBYTEA
0743   0562 7E          	LD	A,(HL)
0744   0563 23          	INC	HL
0745   0564 CD 9E 05    	CALL	PUTBYTEA
0746   0567 7E          	LD	A,(HL)
0747   0568 23          	INC	HL
0748   0569 CD 9E 05    	CALL	PUTBYTEA
0749   056C             	
0750   056C             
0751   056C CD AF 05    	CALL	GETBYTEA		; GET RESULT
0752   056F             
0753   056F             	;CALL	PRTHEXBYTE
0754   056F B7          	OR	A
0755   0570 C0          	RET	NZ
0756   0571             	
0757   0571 B7          	OR	A
0758   0572 C9          	RET
0759   0573             	
0760   0573             SENDCMD:
0761   0573 DB 60       	IN	A,(PIOA)	; DISCARD ANYTHING PENDING
0762   0575             	; WAIT FOR OBF HIGH (OUTPUT BUFFER TO BE EMPTY)
0763   0575 DB 62       	IN	A,(PIOC)
0764   0577 CB 7F       	BIT	7,A
0765   0579 28 F8       	JR	Z,SENDCMD
0766   057B             
0767   057B 3E 01       	LD	A,00000001B	; SET CMD FLAG
0768   057D D3 63       	OUT	(PIOX),A	; SEND IT
0769   057F CD 94 05    	CALL	PUTBYTE		; SEND THE COMMAND BYTE
0770   0582             SENDCMD1:
0771   0582             	; WAIT FOR OBF HIGH (BYTE HAS BEEN RECEIVED)
0772   0582 DB 62       	IN	A,(PIOC)
0773   0584 CB 7F       	BIT	7,A
0774   0586 28 FA       	JR	Z,SENDCMD1
0775   0588             	; TURN OFF CMD
0776   0588 3E 00       	LD	A,00000000B	; CLEAR CMD FLAG
0777   058A D3 63       	OUT	(PIOX),A
0778   058C             	
0779   058C C9          	RET
0780   058D             	
0781   058D             PUTWAIT:
0782   058D             	; WAIT FOR OBF HIGH (BYTE HAS BEEN RECEIVED)
0783   058D DB 62       	IN	A,(PIOC)
0784   058F CB 7F       	BIT	7,A
0785   0591 28 FA       	JR	Z,PUTWAIT
0786   0593 C9          	RET
0787   0594             
0788   0594             PUTBYTE:
0789   0594 DB 62       	IN	A,(PIOC)
0790   0596 CB 7F       	BIT	7,A
0791   0598 28 FA       	JR	Z,PUTBYTE
0792   059A 79          	LD	A,C
0793   059B D3 60       	OUT	(PIOA),A
0794   059D C9          	RET
0795   059E             	
0796   059E             PUTBYTEA:
0797   059E C5          	PUSH	BC
0798   059F 4F          	LD	C,A
0799   05A0 CD 94 05    	CALL	PUTBYTE
0800   05A3 C1          	POP	BC
0801   05A4 C9          	RET
0802   05A5             	
0803   05A5             GETBYTE:
0804   05A5 DB 62       	IN	A,(PIOC)
0805   05A7 CB 6F       	BIT	5,A
0806   05A9 28 FA       	JR	Z,GETBYTE
0807   05AB DB 60       	IN	A,(PIOA)
0808   05AD 4F          	LD	C,A
0809   05AE C9          	RET
0810   05AF             
0811   05AF             GETBYTEA:
0812   05AF C5          	PUSH	BC
0813   05B0 CD A5 05    	CALL	GETBYTE
0814   05B3 79          	LD	A,C
0815   05B4 C1          	POP	BC
0816   05B5 C9          	RET
0817   05B6             ;
0818   05B6             ;
0819   05B6             ;
0820   05B6             PPP_LBA:
0821   05B6 00 00       PPP_LBALO	.DW	0
0822   05B8 00 00       PPP_LBAHI	.DW	0
0823   05BA             PPP_DSKSTAT:
0824   05BA 00 00       PPP_DSKSTLO	.DW	0
0825   05BC 00 00       PPP_DSKSTHI	.DW	0
0826   05BE             ;
0827   05BE 0D 0A 49 6E PPPSTR_INIT	.TEXT	"\r\nInitializing$"
0827   05C2 69 74 69 61 
0827   05C6 6C 69 7A 69 
0827   05CA 6E 67 24 
0828   05CD 0D 0A 42 79 PPPSTR_BYTEECHO	.TEXT	"\r\nByte echo$"
0828   05D1 74 65 20 65 
0828   05D5 63 68 6F 24 
0829   05D9 0D 0A 42 75 PPPSTR_BUFECHO	.TEXT	"\r\nBuffer echo$"
0829   05DD 66 66 65 72 
0829   05E1 20 65 63 68 
0829   05E5 6F 24 
0830   05E7 0D 0A 41 62 PPPSTR_ABTTST	.TEXT	"\r\nAbort command test$"
0830   05EB 6F 72 74 20 
0830   05EF 63 6F 6D 6D 
0830   05F3 61 6E 64 20 
0830   05F7 74 65 73 74 
0830   05FB 24 
0831   05FC 0D 0A 44 69 PPPSTR_DISKRW	.TEXT	"\r\nDisk Read/Write$"
0831   0600 73 6B 20 52 
0831   0604 65 61 64 2F 
0831   0608 57 72 69 74 
0831   060C 65 24 
0832   060E 0D 0A 56 69 PPPSTR_VIDEO	.TEXT	"\r\nVideo$"
0832   0612 64 65 6F 24 
0833   0616 0D 0A 4B 65 PPPSTR_KEYBOARD	.TEXT	"\r\nKeyboard$"
0833   061A 79 62 6F 61 
0833   061E 72 64 24 
0834   0621 0D 0A 53 70 PPPSTR_SPEAKER	.TEXT	"\r\nSpeaker$"
0834   0625 65 61 6B 65 
0834   0629 72 24 
0835   062B 0D 0A 53 65 PPPSTR_SIOLOOP	.TEXT	"\r\nSerial Port Loopback$"
0835   062F 72 69 61 6C 
0835   0633 20 50 6F 72 
0835   0637 74 20 4C 6F 
0835   063B 6F 70 62 61 
0835   063F 63 6B 24 
0836   0642 0D 0A 53 65 PPPSTR_SIOBUF	.TEXT	"\r\nSerial Port Buffer$"
0836   0646 72 69 61 6C 
0836   064A 20 50 6F 72 
0836   064E 74 20 42 75 
0836   0652 66 66 65 72 
0836   0656 24 
0837   0657 0D 0A 2A 43 PPPSTR_CMPERR	.TEXT	"\r\n*COMPARE ERROR*$"
0837   065B 4F 4D 50 41 
0837   065F 52 45 20 45 
0837   0663 52 52 4F 52 
0837   0667 2A 24 
0838   0669 0D 0A 2A 49 PPPSTR_IOERR	.TEXT	"\r\n*IO ERROR*$"
0838   066D 4F 20 45 52 
0838   0671 52 4F 52 2A 
0838   0675 24 
0839   0676 0D 0A 44 49 PPPSTR_DSKSTAT	.TEXT	"\r\nDISK STATUS=$"
0839   067A 53 4B 20 53 
0839   067E 54 41 54 55 
0839   0682 53 3D 24 
0840   0685 4F 4B 24    PPPSTR_OK	.TEXT	"OK$"
0841   0688 54 49 4D 45 PPPSTR_TIMEOUT	.TEXT	"TIMEOUT!$"
0841   068C 4F 55 54 21 
0841   0690 24 
0842   0691 43 4D 44 3D PPPSTR_CMD	.TEXT	"CMD=$"
0842   0695 24 
0843   0696 52 45 53 50 PPPSTR_RSP	.TEXT	"RESP=$"
0843   069A 3D 24 
0844   069C 0D 0A 50 72 PPSTR_KBDPRMPT	.TEXT	"\r\nPress keys on keyboard, <esc> to exit\r\n$"
0844   06A0 65 73 73 20 
0844   06A4 6B 65 79 73 
0844   06A8 20 6F 6E 20 
0844   06AC 6B 65 79 62 
0844   06B0 6F 61 72 64 
0844   06B4 2C 20 3C 65 
0844   06B8 73 63 3E 20 
0844   06BC 74 6F 20 65 
0844   06C0 78 69 74 0D 
0844   06C4 0A 24 
0845   06C6 0D 0A 50 72 PPSTR_SIOPRMPT	.TEXT	"\r\nPress keys on serial terminal, <esc> to exit\r\n$"
0845   06CA 65 73 73 20 
0845   06CE 6B 65 79 73 
0845   06D2 20 6F 6E 20 
0845   06D6 73 65 72 69 
0845   06DA 61 6C 20 74 
0845   06DE 65 72 6D 69 
0845   06E2 6E 61 6C 2C 
0845   06E6 20 3C 65 73 
0845   06EA 63 3E 20 74 
0845   06EE 6F 20 65 78 
0845   06F2 69 74 0D 0A 
0845   06F6 24 
0846   06F7 0D 0A 50 61 PPPSTR_BANNER	.TEXT	"\r\nParPortProp Hardware Validation v0.9\r\n\r\n$"
0846   06FB 72 50 6F 72 
0846   06FF 74 50 72 6F 
0846   0703 70 20 48 61 
0846   0707 72 64 77 61 
0846   070B 72 65 20 56 
0846   070F 61 6C 69 64 
0846   0713 61 74 69 6F 
0846   0717 6E 20 76 30 
0846   071B 2E 39 0D 0A 
0846   071F 0D 0A 24 
0847   0722 49 6E 73 74 PPPSTR_INTRO	.TEXT	"Instructions:\r\n"
0847   0726 72 75 63 74 
0847   072A 69 6F 6E 73 
0847   072E 3A 0D 0A 
0848   0731 20 20 2D 20 		.TEXT	"  - Program ParPortProp with ParPortProp.eeprom\r\n"
0848   0735 50 72 6F 67 
0848   0739 72 61 6D 20 
0848   073D 50 61 72 50 
0848   0741 6F 72 74 50 
0848   0745 72 6F 70 20 
0848   0749 77 69 74 68 
0848   074D 20 50 61 72 
0848   0751 50 6F 72 74 
0848   0755 50 72 6F 70 
0848   0759 2E 65 65 70 
0848   075D 72 6F 6D 0D 
0848   0761 0A 
0849   0762 20 20 2D 20 		.TEXT	"  - Insert SD Card (EXISTING DATA WILL BE DESTROYED!!!)\r\n"
0849   0766 49 6E 73 65 
0849   076A 72 74 20 53 
0849   076E 44 20 43 61 
0849   0772 72 64 20 28 
0849   0776 45 58 49 53 
0849   077A 54 49 4E 47 
0849   077E 20 44 41 54 
0849   0782 41 20 57 49 
0849   0786 4C 4C 20 42 
0849   078A 45 20 44 45 
0849   078E 53 54 52 4F 
0849   0792 59 45 44 21 
0849   0796 21 21 29 0D 
0849   079A 0A 
0850   079B 20 20 2D 20 		.TEXT	"  - Attach a VGA monitor and PS/2 keyboard\r\n"
0850   079F 41 74 74 61 
0850   07A3 63 68 20 61 
0850   07A7 20 56 47 41 
0850   07AB 20 6D 6F 6E 
0850   07AF 69 74 6F 72 
0850   07B3 20 61 6E 64 
0850   07B7 20 50 53 2F 
0850   07BB 32 20 6B 65 
0850   07BF 79 62 6F 61 
0850   07C3 72 64 0D 0A 
0851   07C7 20 20 2D 20 		.TEXT	"  - Cross connect pins 2 & 3 of DE-9 serial port connector\r\n"
0851   07CB 43 72 6F 73 
0851   07CF 73 20 63 6F 
0851   07D3 6E 6E 65 63 
0851   07D7 74 20 70 69 
0851   07DB 6E 73 20 32 
0851   07DF 20 26 20 33 
0851   07E3 20 6F 66 20 
0851   07E7 44 45 2D 39 
0851   07EB 20 73 65 72 
0851   07EF 69 61 6C 20 
0851   07F3 70 6F 72 74 
0851   07F7 20 63 6F 6E 
0851   07FB 6E 65 63 74 
0851   07FF 6F 72 0D 0A 
0852   0803 20 20 2D 20 		.TEXT	"  - Press <Esc> on keyboard to end keyboard test\r\n$"
0852   0807 50 72 65 73 
0852   080B 73 20 3C 45 
0852   080F 73 63 3E 20 
0852   0813 6F 6E 20 6B 
0852   0817 65 79 62 6F 
0852   081B 61 72 64 20 
0852   081F 74 6F 20 65 
0852   0823 6E 64 20 6B 
0852   0827 65 79 62 6F 
0852   082B 61 72 64 20 
0852   082F 74 65 73 74 
0852   0833 0D 0A 24 
0853   0836 0D 0A 50 72 PPPSTR_CONFIRM	.TEXT	"\r\nPress <Enter> to continue, <Esc> to abort$"
0853   083A 65 73 73 20 
0853   083E 3C 45 6E 74 
0853   0842 65 72 3E 20 
0853   0846 74 6F 20 63 
0853   084A 6F 6E 74 69 
0853   084E 6E 75 65 2C 
0853   0852 20 3C 45 73 
0853   0856 63 3E 20 74 
0853   085A 6F 20 61 62 
0853   085E 6F 72 74 24 
0854   0862             
0855   0862             ;
0856   0862             ;==================================================================================================
0857   0862             ; UTILITY FUNCTIONS
0858   0862             ;==================================================================================================
0859   0862             ;
0860   0862             ;
0861   0862             CHR_CR		.EQU	0DH
0862   0862             CHR_LF		.EQU	0AH
0863   0862             CHR_BS		.EQU	08H
0864   0862             CHR_ESC		.EQU	1BH
0865   0862             ;
0866   0862             ;__________________________________________________________________________________________________
0867   0862             ;
0868   0862             ; UTILITY PROCS TO PRINT SINGLE CHARACTERS WITHOUT TRASHING ANY REGISTERS
0869   0862             ;
0870   0862             PC_SPACE:
0871   0862 F5          	PUSH	AF
0872   0863 3E 20       	LD	A,' '
0873   0865 18 1E       	JR	PC_PRTCHR
0874   0867             
0875   0867             PC_PERIOD:
0876   0867 F5          	PUSH	AF
0877   0868 3E 2E       	LD	A,'.'
0878   086A 18 19       	JR	PC_PRTCHR
0879   086C             
0880   086C             PC_COLON:
0881   086C F5          	PUSH	AF
0882   086D 3E 3A       	LD	A,':'
0883   086F 18 14       	JR	PC_PRTCHR
0884   0871             
0885   0871             PC_LBKT:
0886   0871 F5          	PUSH	AF
0887   0872 3E 5B       	LD	A,'['
0888   0874 18 0F       	JR	PC_PRTCHR
0889   0876             
0890   0876             PC_RBKT:
0891   0876 F5          	PUSH	AF
0892   0877 3E 5D       	LD	A,']'
0893   0879 18 0A       	JR	PC_PRTCHR
0894   087B             
0895   087B             PC_CR:
0896   087B F5          	PUSH	AF
0897   087C 3E 0D       	LD	A,CHR_CR
0898   087E 18 05       	JR	PC_PRTCHR
0899   0880             
0900   0880             PC_LF:
0901   0880 F5          	PUSH	AF
0902   0881 3E 0A       	LD	A,CHR_LF
0903   0883 18 00       	JR	PC_PRTCHR
0904   0885             
0905   0885             PC_PRTCHR:
0906   0885 CD A2 09    	CALL	COUT
0907   0888 F1          	POP	AF
0908   0889 C9          	RET
0909   088A             
0910   088A             NEWLINE:
0911   088A CD 7B 08    	CALL	PC_CR
0912   088D CD 80 08    	CALL	PC_LF
0913   0890 C9          	RET
0914   0891             ;
0915   0891             ; PRINT THE HEX BYTE VALUE IN A
0916   0891             ;
0917   0891             PRTHEXBYTE:
0918   0891 F5          	PUSH	AF
0919   0892 D5          	PUSH	DE
0920   0893 11 B6 0A    	LD	DE,HEXSTRBUF
0921   0896 CD C0 08    	CALL	HEXSTRBYTE
0922   0899 3E 24       	LD	A,'$'
0923   089B 12          	LD	(DE),A
0924   089C 11 B6 0A    	LD	DE,HEXSTRBUF
0925   089F CD 0D 09    	CALL	WRITESTR
0926   08A2 D1          	POP	DE
0927   08A3 F1          	POP	AF
0928   08A4 C9          	RET
0929   08A5             ;
0930   08A5             ; PRINT THE HEX WORD VALUE IN BC
0931   08A5             ;
0932   08A5             PRTHEXWORD:
0933   08A5 F5          	PUSH	AF
0934   08A6 78          	LD	A,B
0935   08A7 CD 91 08    	CALL	PRTHEXBYTE
0936   08AA 79          	LD	A,C
0937   08AB CD 91 08    	CALL	PRTHEXBYTE
0938   08AE F1          	POP	AF
0939   08AF C9          	RET
0940   08B0             ;
0941   08B0             ; CONVERT VALUE IN A TO A 2 CHARACTER HEX STRING AT DE
0942   08B0             ;
0943   08B0 30 31 32 33 HEXCHR	.TEXT	"0123456789ABCDEF"
0943   08B4 34 35 36 37 
0943   08B8 38 39 41 42 
0943   08BC 43 44 45 46 
0944   08C0             ;
0945   08C0             HEXSTRBYTE:
0946   08C0 C5          	PUSH	BC
0947   08C1 E5          	PUSH	HL
0948   08C2 F5          	PUSH	AF
0949   08C3 01 00 00    	LD	BC,0
0950   08C6 1F          	RRA
0951   08C7 1F          	RRA
0952   08C8 1F          	RRA
0953   08C9 1F          	RRA
0954   08CA E6 0F       	AND	0FH
0955   08CC 4F          	LD	C,A
0956   08CD 21 B0 08    	LD	HL,HEXCHR
0957   08D0 09          	ADD	HL,BC
0958   08D1 7E          	LD	A,(HL)
0959   08D2 12          	LD	(DE),A
0960   08D3 13          	INC	DE
0961   08D4 F1          	POP	AF
0962   08D5 F5          	PUSH	AF
0963   08D6 01 00 00    	LD	BC,0
0964   08D9 E6 0F       	AND	0FH
0965   08DB 4F          	LD	C,A
0966   08DC 21 B0 08    	LD	HL,HEXCHR
0967   08DF 09          	ADD	HL,BC
0968   08E0 7E          	LD	A,(HL)
0969   08E1 12          	LD	(DE),A
0970   08E2 13          	INC	DE
0971   08E3 F1          	POP	AF
0972   08E4 E1          	POP	HL
0973   08E5 C1          	POP	BC
0974   08E6 C9          	RET
0975   08E7             ;
0976   08E7             ; CONVERT VALUE IN BC TO A 4 CHARACTER HEX STRING AT DE
0977   08E7             ;
0978   08E7             HEXSTRWORD:
0979   08E7 78          	LD	A,B
0980   08E8 CD C0 08    	CALL	HEXSTRBYTE
0981   08EB 79          	LD	A,C
0982   08EC CD C0 08    	CALL	HEXSTRBYTE
0983   08EF C9          	RET
0984   08F0             
0985   08F0             ;
0986   08F0             ; PRINT A BYTE BUFFER IN HEX POINTED TO BY DE
0987   08F0             ; REGISTER A HAS SIZE OF BUFFER
0988   08F0             ;
0989   08F0             PRTHEXBUF:
0990   08F0 FE 00       	CP	0		; EMPTY BUFFER?
0991   08F2 CA 03 09    	JP	Z,PRTHEXBUF2
0992   08F5             	
0993   08F5 47          	LD	B,A
0994   08F6             PRTHEXBUF1:
0995   08F6 CD 62 08    	CALL	PC_SPACE
0996   08F9 1A          	LD	A,(DE)
0997   08FA CD 91 08    	CALL	PRTHEXBYTE
0998   08FD 13          	INC	DE
0999   08FE 10 F6       	DJNZ	PRTHEXBUF1
1000   0900 C3 0C 09    	JP	PRTHEXBUFX
1001   0903             	
1002   0903             PRTHEXBUF2:
1003   0903 CD 62 08    	CALL	PC_SPACE
1004   0906 11 AE 0A    	LD	DE,STR_EMPTY
1005   0909 CD 0D 09    	CALL	WRITESTR
1006   090C             
1007   090C             PRTHEXBUFX:
1008   090C C9          	RET
1009   090D             ;
1010   090D             ; OUTPUT A '$' TERMINATED STRING
1011   090D             ;
1012   090D             WRITESTR:
1013   090D 1A          	LD	A,(DE)
1014   090E FE 24       	CP	'$'			; TEST FOR STRING TERMINATOR
1015   0910 C8          	RET	Z			; DONE
1016   0911 CD A2 09    	CALL	COUT
1017   0914 13          	INC	DE
1018   0915 C3 0D 09    	JP	WRITESTR		; TRANSMIT LOOP
1019   0918             ;
1020   0918             ; PANIC: TRY TO DUMP MACHINE STATE AND HALT
1021   0918             ;
1022   0918             PANIC:
1023   0918 E5          	PUSH	HL
1024   0919 D5          	PUSH	DE
1025   091A C5          	PUSH	BC
1026   091B F5          	PUSH	AF
1027   091C 11 57 09    	LD	DE,STR_PANIC
1028   091F CD 0D 09    	CALL	WRITESTR
1029   0922 11 6C 09    	LD	DE,STR_AF
1030   0925 CD 0D 09    	CALL	WRITESTR
1031   0928 C1          	POP	BC
1032   0929 CD A5 08    	CALL	PRTHEXWORD
1033   092C 11 71 09    	LD	DE,STR_BC
1034   092F CD 0D 09    	CALL	WRITESTR
1035   0932 C1          	POP	BC
1036   0933 CD A5 08    	CALL	PRTHEXWORD
1037   0936 11 76 09    	LD	DE,STR_DE
1038   0939 CD 0D 09    	CALL	WRITESTR
1039   093C C1          	POP	BC
1040   093D CD A5 08    	CALL	PRTHEXWORD
1041   0940 11 7B 09    	LD	DE,STR_HL
1042   0943 CD 0D 09    	CALL	WRITESTR
1043   0946 C1          	POP	BC
1044   0947 CD A5 08    	CALL	PRTHEXWORD
1045   094A 11 80 09    	LD	DE,STR_PC
1046   094D CD 0D 09    	CALL	WRITESTR
1047   0950 C1          	POP	BC
1048   0951 CD A5 08    	CALL	PRTHEXWORD
1049   0954 C3 00 00    	JP	0
1050   0957             ;
1051   0957 0D 0A 0D 0A STR_PANIC	.DB	"\r\n\r\n>>> FATAL ERROR:$"
1051   095B 3E 3E 3E 20 
1051   095F 46 41 54 41 
1051   0963 4C 20 45 52 
1051   0967 52 4F 52 3A 
1051   096B 24 
1052   096C 20 41 46 3D STR_AF		.DB	" AF=$"
1052   0970 24 
1053   0971 20 42 43 3D STR_BC		.DB	" BC=$"
1053   0975 24 
1054   0976 20 44 45 3D STR_DE		.DB	" DE=$"
1054   097A 24 
1055   097B 20 48 4C 3D STR_HL		.DB	" HL=$"
1055   097F 24 
1056   0980 20 50 43 3D STR_PC		.DB	" PC=$"
1056   0984 24 
1057   0985             ;
1058   0985             ; INDIRECT JUMP TO ADDRESS IN HL
1059   0985             ;
1060   0985             ;   MOSTLY USEFUL TO PERFORM AN INDIRECT CALL LIKE:
1061   0985             ;     LD	HL,xxxx
1062   0985             ;     CALL	JPHL
1063   0985             ;
1064   0985 E9          JPHL:	JP	(HL)
1065   0986             ;
1066   0986             ; DELAY ABOUT 25us (100 TSTATES INCLUDING CALL AND RET)
1067   0986             ;
1068   0986             ;	TOTAL T STATES = ((B*13) + 51)
1069   0986             ;	4MHZ CPU, B=4, 103 T STATES = 25.75us
1070   0986             ;	8MHZ CPU, B=12, 207 TSTATES = 25.875us
1071   0986             ;	B = ((2 * FREQ) - 4)
1072   0986             ;
1073   0986             DELAY:					; 17 T STATES (FOR CALL)
1074   0986 C5          	PUSH	BC			; 11 T STATES
1075   0987 06 24       	LD	B,((CPUFREQ * 2)  - 4)	; 8 T STATES
1076   0989 10 FE       	DJNZ	$			; (B*13) - 5 T STATES
1077   098B C1          	POP	BC			; 10 T STATES
1078   098C C9          	RET				; 10 T STATES
1079   098D             ;
1080   098D             ; DELAY 25us * VALUE IN DE (VARIABLE DELAY)
1081   098D             ;
1082   098D             VDELAY:
1083   098D CD 86 09    	CALL	DELAY
1084   0990 1B          	DEC	DE
1085   0991 7A          	LD	A,D
1086   0992 B3          	OR	E
1087   0993 C2 8D 09    	JP	NZ,VDELAY
1088   0996 C9          	RET
1089   0997             ;
1090   0997             ; DELAY ABOUT 0.5 SECONDS = 25us * 20,000
1091   0997             ;
1092   0997             LDELAY:
1093   0997 D5          	PUSH	DE
1094   0998 11 20 4E    	LD	DE,20000
1095   099B CD 8D 09    	CALL	VDELAY
1096   099E D1          	POP	DE
1097   099F C9          	RET
1098   09A0             ;
1099   09A0             ; COUT
1100   09A0             ;
1101   09A0 20 24       COUT_BUFFER	.TEXT	" $"
1102   09A2             ;
1103   09A2             COUT:
1104   09A2 C5          	PUSH	BC			;
1105   09A3 F5          	PUSH	AF			;
1106   09A4 E5          	PUSH	HL			;
1107   09A5 D5          	PUSH	DE			;
1108   09A6 32 A0 09    	LD	(COUT_BUFFER),A		;
1109   09A9 11 A0 09    	LD	DE,COUT_BUFFER		;
1110   09AC 0E 09       	LD	C,09H			; CP/M WRITE START STRING TO CONSOLE CALL
1111   09AE CD 05 00    	CALL	0005H
1112   09B1 D1          	POP	DE			;
1113   09B2 E1          	POP	HL			;
1114   09B3 F1          	POP	AF			;
1115   09B4 C1          	POP	BC			;
1116   09B5 C9          	RET				; DONE
1117   09B6             ;
1118   09B6             ; INPUT CHARACTER TO A
1119   09B6             ;
1120   09B6             CIN:
1121   09B6 C5          	PUSH	BC
1122   09B7 D5          	PUSH	DE
1123   09B8 E5          	PUSH	HL
1124   09B9 0E 01       	LD	C,01H
1125   09BB CD 05 00    	CALL	0005H
1126   09BE E1          	POP	HL
1127   09BF D1          	POP	DE
1128   09C0 C1          	POP	BC
1129   09C1 C9          	RET
1130   09C2             ;
1131   09C2             ; PRINT A BLOCK OF MEMORY NICELY FORMATTED
1132   09C2             ;  DE=BUFFER ADDRESS
1133   09C2             ;
1134   09C2             DUMP_BUFFER:
1135   09C2 CD 8A 08    	CALL	NEWLINE
1136   09C5             
1137   09C5 D5          	PUSH	DE
1138   09C6 E1          	POP	HL
1139   09C7 14          	INC	D
1140   09C8 14          	INC	D
1141   09C9             	
1142   09C9             BLKRD:
1143   09C9 CD FF 09    	CALL	PHL			; PRINT START LOCATION
1144   09CC 0E 10       	LD	C,16			; SET FOR 16 LOCS
1145   09CE E5          	PUSH	HL			; SAVE STARTING HL
1146   09CF             NXTONE:
1147   09CF 7E          	LD 	A,(HL)			; GET BYTE
1148   09D0 CD 91 08    	CALL	PRTHEXBYTE		; PRINT IT
1149   09D3 CD 62 08    	CALL	PC_SPACE		;
1150   09D6             UPDH:	
1151   09D6 23          	INC	HL			; POINT NEXT
1152   09D7 0D          	DEC	C			; DEC. LOC COUNT
1153   09D8 20 F5       	JR	NZ,NXTONE		; IF LINE NOT DONE
1154   09DA             					; NOW PRINT 'DECODED' DATA TO RIGHT OF DUMP
1155   09DA             PCRLF:
1156   09DA CD 62 08    	CALL	PC_SPACE		; SPACE IT
1157   09DD 0E 10       	LD	C,16			; SET FOR 16 CHARS
1158   09DF E1          	POP	HL			; GET BACK START
1159   09E0             PCRLF0:
1160   09E0 7E          	LD	A,(HL)			; GET BYTE
1161   09E1 E6 60       	AND	060H			; SEE IF A 'DOT'
1162   09E3 7E          	LD	A,(HL)			; O.K. TO GET
1163   09E4 20 02       	JR	NZ,PDOT			;
1164   09E6             DOT:
1165   09E6 3E 2E       	LD	A,2EH			; LOAD A DOT	
1166   09E8             PDOT:
1167   09E8 CD A2 09    	CALL	COUT			; PRINT IT
1168   09EB 23          	INC	HL			; 
1169   09EC 7A          	LD	A,D			;
1170   09ED BC          	CP	H			;
1171   09EE 20 05       	JR	NZ,UPDH1		;
1172   09F0 7B          	LD	A,E			;
1173   09F1 BD          	CP	L			;
1174   09F2 CA FE 09    	JP	Z,DUMP_END		;
1175   09F5             ;
1176   09F5             ;IF BLOCK NOT DUMPED, DO NEXT CHARACTER OR LINE
1177   09F5             UPDH1:
1178   09F5 0D          	DEC	C			; DEC. CHAR COUNT
1179   09F6 20 E8       	JR	NZ,PCRLF0		; DO NEXT
1180   09F8             CONTD:
1181   09F8 CD 8A 08    	CALL	NEWLINE			;
1182   09FB C3 C9 09    	JP	BLKRD			;
1183   09FE             
1184   09FE             DUMP_END:	
1185   09FE C9          	RET				;
1186   09FF             ;__PHL_________________________________________________________________________________________________________________________ 
1187   09FF             ;
1188   09FF             ;	PRINT THE HL REG ON THE SERIAL PORT
1189   09FF             ;________________________________________________________________________________________________________________________________
1190   09FF             ;
1191   09FF             PHL:
1192   09FF 7C          	LD	A,H			; GET HI BYTE
1193   0A00 CD 91 08    	CALL	PRTHEXBYTE		; DO HEX OUT ROUTINE
1194   0A03 7D          	LD	A,L			; GET LOW BYTE
1195   0A04 CD 91 08    	CALL	PRTHEXBYTE		; HEX IT
1196   0A07 CD 62 08    	CALL	PC_SPACE
1197   0A0A C9          	RET				; DONE  
1198   0A0B             
1199   0A0B             ;
1200   0A0B             ; CLEAR BUFFER WITH $00
1201   0A0B             ;
1202   0A0B             CLR_BUFFER:
1203   0A0B 21 00 A0    	LD	HL,SECBUF
1204   0A0E 01 00 02    	LD	BC,BUFSIZ
1205   0A11             CLR_BUFFER1:
1206   0A11 3E 00       	LD	A,0
1207   0A13 77          	LD	(HL),A
1208   0A14 23          	INC	HL
1209   0A15 0B          	DEC	BC
1210   0A16 78          	LD	A,B
1211   0A17 B1          	OR	C
1212   0A18 C2 11 0A    	JP	NZ,CLR_BUFFER1
1213   0A1B C9          	RET
1214   0A1C             ;
1215   0A1C             ; INITIALIZE BUFFER WITH FILLER BYTE $FF
1216   0A1C             ;
1217   0A1C             FILL_BUFFER:
1218   0A1C 21 00 A0    	LD	HL,SECBUF
1219   0A1F 01 00 02    	LD	BC,BUFSIZ
1220   0A22             FILL_BUFFER1:
1221   0A22 3E FF       	LD	A,0FFH
1222   0A24 77          	LD	(HL),A
1223   0A25 23          	INC	HL
1224   0A26 0B          	DEC	BC
1225   0A27 78          	LD	A,B
1226   0A28 B1          	OR	C
1227   0A29 C2 22 0A    	JP	NZ,FILL_BUFFER1
1228   0A2C C9          	RET
1229   0A2D             ;
1230   0A2D             ; INITIALIZE BUFFER WITH PATTERN 00-FF
1231   0A2D             ;
1232   0A2D             PAT_BUFFER:
1233   0A2D 21 00 A0    	LD	HL,SECBUF
1234   0A30 01 00 02    	LD	BC,BUFSIZ
1235   0A33 16 00       	LD	D,0
1236   0A35             PAT_BUFFER1:
1237   0A35 7A          	LD	A,D
1238   0A36 77          	LD	(HL),A
1239   0A37 23          	INC	HL
1240   0A38 0B          	DEC	BC
1241   0A39 14          	INC	D
1242   0A3A 78          	LD	A,B
1243   0A3B B1          	OR	C
1244   0A3C C2 35 0A    	JP	NZ,PAT_BUFFER1
1245   0A3F C9          	RET
1246   0A40             ;
1247   0A40             ; INITIALIZE BUFFER WITH RANDOM BYTES
1248   0A40             ;   HL = ADDRESS OF BUFFER
1249   0A40             ;   DE = SIZE OF BUFFER
1250   0A40             ;
1251   0A40             RND_BUFFER:
1252   0A40 21 00 A0    	LD	HL,SECBUF
1253   0A43 01 00 02    	LD	BC,BUFSIZ
1254   0A46             RND_BUFFER1:
1255   0A46 CD 9C 0A    	CALL	RNDBYTE
1256   0A49 77          	LD	(HL),A
1257   0A4A 23          	INC	HL
1258   0A4B 0B          	DEC	BC
1259   0A4C 78          	LD	A,B
1260   0A4D B1          	OR	C
1261   0A4E C2 46 0A    	JP	NZ,RND_BUFFER1
1262   0A51 C9          	RET
1263   0A52             
1264   0A52             RND_BUFFERX:
1265   0A52 21 00 B0    	LD	HL,SAVBUF
1266   0A55 01 00 02    	LD	BC,BUFSIZ
1267   0A58             RND_BUFFERX1:
1268   0A58 CD 9C 0A    	CALL	RNDBYTE
1269   0A5B 77          	LD	(HL),A
1270   0A5C 23          	INC	HL
1271   0A5D 0B          	DEC	BC
1272   0A5E 78          	LD	A,B
1273   0A5F B1          	OR	C
1274   0A60 C2 58 0A    	JP	NZ,RND_BUFFERX1
1275   0A63 C9          	RET
1276   0A64             ;
1277   0A64             ; SAVE_BUFFER
1278   0A64             ;	
1279   0A64             SAVE_BUFFER:
1280   0A64 21 00 A0    	LD	HL,SECBUF
1281   0A67 11 00 B0    	LD	DE,SAVBUF
1282   0A6A 01 00 02    	LD	BC,BUFSIZ
1283   0A6D ED B0       	LDIR
1284   0A6F C9          	RET
1285   0A70             ;
1286   0A70             ; CMP_BUFFER
1287   0A70             ;   HL = ADDRESS OF SOURCE BUFFER
1288   0A70             ;   DE = ADDRESS OF DESTINATION BUFFER
1289   0A70             ;   BC = SIZE OF BUFFER
1290   0A70             ;   RETURNS Z IF EQUAL, NZ IF DIFFERENT
1291   0A70             ;
1292   0A70             CMP_BUFFER:
1293   0A70 21 00 A0    	LD	HL,SECBUF
1294   0A73 11 00 B0    	LD	DE,SAVBUF
1295   0A76 01 00 02    	LD	BC,BUFSIZ
1296   0A79             
1297   0A79             CMP_BUFFER1:
1298   0A79 1A          	LD	A,(DE)
1299   0A7A BE          	CP	(HL)
1300   0A7B C2 87 0A    	JP	NZ,CMP_BUFFER_MISMATCH
1301   0A7E 13          	INC	DE
1302   0A7F 23          	INC	HL
1303   0A80 0B          	DEC	BC
1304   0A81 78          	LD	A,B
1305   0A82 B1          	OR	C
1306   0A83 C2 79 0A    	JP	NZ,CMP_BUFFER1
1307   0A86 C9          	RET				; RET W/ Z SET
1308   0A87             
1309   0A87             CMP_BUFFER_MISMATCH:
1310   0A87 D5          	PUSH	DE
1311   0A88 11 EB 0A    	LD	DE,STR_MISMATCH
1312   0A8B CD 0D 09    	CALL	WRITESTR
1313   0A8E D1          	POP	DE
1314   0A8F 7A          	LD	A,D
1315   0A90 CD 91 08    	CALL	PRTHEXBYTE
1316   0A93 7B          	LD	A,E
1317   0A94 CD 91 08    	CALL	PRTHEXBYTE
1318   0A97 3E FF       	LD	A,0FFH
1319   0A99 B7          	OR	A			; RET W/ NZ SET
1320   0A9A C9          	RET
1321   0A9B             ;
1322   0A9B             ; GENERATE A RANDOM BYTE
1323   0A9B             ;
1324   0A9B             ; RETURNS PSEUDO RANDOM 8 BIT NUMBER IN A. ONLY AFFECTS A.
1325   0A9B             ; (SEED) IS THE BYTE FROM WHICH THE NUMBER IS GENERATED AND MUST BE	
1326   0A9B             ; INITIALIZED TO A NON ZERO VALUE OR THIS FUNCTION WILL ALWAYS RETURN
1327   0A9B             ; ZERO.
1328   0A9B             ;
1329   0A9B 01          RB_SEED		.DB	1		; RNDBYTE SEED (MUST NOT BE ZERO)
1330   0A9C             ;
1331   0A9C             RNDBYTE:
1332   0A9C 3A 9B 0A    	LD	A,(RB_SEED)	; GET SEED
1333   0A9F E6 B8       	AND	0B8H		; MASK NON-FEEDBACK BITS
1334   0AA1 37          	SCF			; SET CARRY
1335   0AA2 E2 A6 0A    	JP	PO,RB_NC	; SKIP CLEAR IF ODD
1336   0AA5 3F          	CCF			; COMPLEMENT CARRY (CLEAR IT)
1337   0AA6 3A 9B 0A    RB_NC	LD	A,(RB_SEED)	; GET SEED BACK
1338   0AA9 17          	RLA			; ROTATE CARRY INTO BYTE
1339   0AAA 32 9B 0A    	LD	(RB_SEED),A	; SAVE BACK FOR NEXT
1340   0AAD C9          	RET			; DONE
1341   0AAE             ;
1342   0AAE             ;
1343   0AAE             ;
1344   0AAE 3C 45 4D 50 STR_EMPTY	.TEXT	"<EMPTY>$"
1344   0AB2 54 59 3E 24 
1345   0AB6 58 58 24    HEXSTRBUF	.TEXT	"XX$"
1346   0AB9 53 4F 55 52 STR_SRC		.TEXT	"SOURCE: $"
1346   0ABD 43 45 3A 20 
1346   0AC1 24 
1347   0AC2 44 45 53 54 STR_DEST	.TEXT	"DESTINATION: $"
1347   0AC6 49 4E 41 54 
1347   0ACA 49 4F 4E 3A 
1347   0ACE 20 24 
1348   0AD0 42 45 46 4F STR_BEFORE	.TEXT	"BEFORE:$"
1348   0AD4 52 45 3A 24 
1349   0AD8 41 46 54 45 STR_AFTER	.TEXT	"AFTER:$"
1349   0ADC 52 3A 24 
1350   0ADF 52 45 47 49 STR_REGS	.TEXT	"REGISTERS: $"
1350   0AE3 53 54 45 52 
1350   0AE7 53 3A 20 24 
1351   0AEB 0D 0A 0D 0A STR_MISMATCH	.TEXT	"\r\n\r\n*** DATA MISMATCH AT $"
1351   0AEF 2A 2A 2A 20 
1351   0AF3 44 41 54 41 
1351   0AF7 20 4D 49 53 
1351   0AFB 4D 41 54 43 
1351   0AFF 48 20 41 54 
1351   0B03 20 24 
1352   0B05 0D 0A 0D 0A STR_IDENTITY	.TEXT	"\r\n\r\nDEVICE IDENTITY DATA:\r\n$"
1352   0B09 44 45 56 49 
1352   0B0D 43 45 20 49 
1352   0B11 44 45 4E 54 
1352   0B15 49 54 59 20 
1352   0B19 44 41 54 41 
1352   0B1D 3A 0D 0A 24 
1353   0B21 0D 0A 0D 0A STR_FILLTEST	.TEXT	"\r\n\r\nPERFORMING FILL TEST...$"
1353   0B25 50 45 52 46 
1353   0B29 4F 52 4D 49 
1353   0B2D 4E 47 20 46 
1353   0B31 49 4C 4C 20 
1353   0B35 54 45 53 54 
1353   0B39 2E 2E 2E 24 
1354   0B3D 0D 0A 0D 0A STR_PATTEST	.TEXT	"\r\n\r\nPERFORMING PATTERN TEST...$"
1354   0B41 50 45 52 46 
1354   0B45 4F 52 4D 49 
1354   0B49 4E 47 20 50 
1354   0B4D 41 54 54 45 
1354   0B51 52 4E 20 54 
1354   0B55 45 53 54 2E 
1354   0B59 2E 2E 24 
1355   0B5C 0D 0A 0D 0A STR_RNDTEST	.TEXT	"\r\n\r\nPERFORMING RANDOM TEST...$"
1355   0B60 50 45 52 46 
1355   0B64 4F 52 4D 49 
1355   0B68 4E 47 20 52 
1355   0B6C 41 4E 44 4F 
1355   0B70 4D 20 54 45 
1355   0B74 53 54 2E 2E 
1355   0B78 2E 24 
1356   0B7A 0D 0A 0D 0A STR_PROBTEST	.TEXT	"\r\n\r\nPERFORMING PROBLEM BUFFER TEST...$"
1356   0B7E 50 45 52 46 
1356   0B82 4F 52 4D 49 
1356   0B86 4E 47 20 50 
1356   0B8A 52 4F 42 4C 
1356   0B8E 45 4D 20 42 
1356   0B92 55 46 46 45 
1356   0B96 52 20 54 45 
1356   0B9A 53 54 2E 2E 
1356   0B9E 2E 24 
1357   0BA0 0D 0A 0D 0A STR_SUCCESS	.TEXT	"\r\n\r\nALL TESTS COMPLETED -- NO ERRORS\r\n$"
1357   0BA4 41 4C 4C 20 
1357   0BA8 54 45 53 54 
1357   0BAC 53 20 43 4F 
1357   0BB0 4D 50 4C 45 
1357   0BB4 54 45 44 20 
1357   0BB8 2D 2D 20 4E 
1357   0BBC 4F 20 45 52 
1357   0BC0 52 4F 52 53 
1357   0BC4 0D 0A 24 
1358   0BC7 0D 0A 0D 0A STR_FAILURE	.TEXT	"\r\n\r\nTEST FAILURE -- REVIEW ERRORS\r\n$"
1358   0BCB 54 45 53 54 
1358   0BCF 20 46 41 49 
1358   0BD3 4C 55 52 45 
1358   0BD7 20 2D 2D 20 
1358   0BDB 52 45 56 49 
1358   0BDF 45 57 20 45 
1358   0BE3 52 52 4F 52 
1358   0BE7 53 0D 0A 24 
1359   0BEB 20 53 41 52 STR_SAR		.TEXT	" SAR=$"
1359   0BEF 3D 24 
1360   0BF1 20 44 41 52 STR_DAR		.TEXT	" DAR=$"
1360   0BF5 3D 24 
1361   0BF7 20 42 43 52 STR_BCR		.TEXT	" BCR=$"
1361   0BFB 3D 24 
1362   0BFD 20 44 53 54 STR_DSTAT	.TEXT	" DSTAT=$"
1362   0C01 41 54 3D 24 
1363   0C05 20 44 4D 4F STR_DMODE	.TEXT	" DMODE=$"
1363   0C09 44 45 3D 24 
1364   0C0D 20 44 43 4E STR_DCNTL	.TEXT	" DCNTL=$"
1364   0C11 54 4C 3D 24 
1365   0C15             
1366   0C15             SECBUF		.EQU	0A000H
1367   0C15             SAVBUF		.EQU	0B000H
1368   0C15             BUFSIZ		.EQU	00200H
1369   0C15             
1370   0C15 00 00       STACKSAV	.DW	0
1371   0C17             STACKSIZ	.EQU	40H		; WE ARE A STACK PIG
1372   0C17 00 00 00 00 		.FILL	STACKSIZ,0
1372   0C1B 00 00 00 00 
1372   0C1F 00 00 00 00 
1372   0C23 00 00 00 00 
1372   0C27 00 00 00 00 
1372   0C2B 00 00 00 00 
1372   0C2F 00 00 00 00 
1372   0C33 00 00 00 00 
1372   0C37 00 00 00 00 
1372   0C3B 00 00 00 00 
1372   0C3F 00 00 00 00 
1372   0C43 00 00 00 00 
1372   0C47 00 00 00 00 
1372   0C4B 00 00 00 00 
1372   0C4F 00 00 00 00 
1372   0C53 00 00 00 00 
1373   0C57             STACK		.EQU	$
1374   0C57             
1375   0C57             	.ENDtasm: Number of errors = 0
